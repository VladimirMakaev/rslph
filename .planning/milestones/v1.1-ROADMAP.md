# Milestone v1.1: Testing Enhancement

**Status:** ✅ SHIPPED 2026-01-19
**Phases:** 7-7.1
**Total Plans:** 6

## Overview

v1.1 "Testing Enhancement" adds comprehensive E2E testing with fake Claude simulation and TUI snapshot tests.

## Phases

### Phase 7: E2E Testing Framework

**Goal**: Comprehensive all-Rust testing infrastructure with fake Claude simulation for deterministic, reproducible testing of the Ralph Wiggum Loop
**Depends on**: Phase 6 (TUI complete)
**Requirements**: TEST-01 through TEST-12
**Plans**: 5 plans in 4 waves

**Success Criteria** (what must be TRUE):
  1. Rust fake-claude binary exists with fluent scenario API
  2. Fake Claude produces stream-json format matching real Claude CLI (reuses existing types)
  3. Tool calls (Read, Write, Edit, Bash) can be simulated with configurable results
  4. Progress file manipulation (mark complete, RALPH_DONE) is testable
  5. Edge cases are covered (timeout, crash, malformed output, fast output)
  6. Workspace fixture manages temp directories with config and source files (Rust)
  7. Verifier helpers assert on task completion, file content, git commits (Rust)
  8. E2E tests verify complete integration
  9. Multi-invocation support for testing retry/failure memory
  10. True E2E integration tests run rslph with fake Claude

Plans:
- [x] 07-01-PLAN.md — Core fake-claude infrastructure with stream-json output
- [x] 07-02-PLAN.md — Workspace fixtures and verifier helpers
- [x] 07-03-PLAN.md — Tool calls, edge cases, multi-invocation support
- [x] 07-04-PLAN.md — Infrastructure verification tests
- [x] 07-05-PLAN.md — True E2E integration tests (rslph with fake Claude)

### Phase 7.1: TUI Testing with TestBackend + insta (INSERTED)

**Goal**: Implement TUI-specific snapshot tests using ratatui TestBackend and insta
**Depends on**: Phase 7 (E2E testing infrastructure)
**Plans**: 1 plan

**Context**: Phase 7 deferred TUI testing. Research determined TestBackend + insta is the right approach (ratatui-testlib is PTY-based overkill). This phase implements TUI rendering and key handling tests.

**Success Criteria** (what must be TRUE):
  1. ratatui-testlib API verified and documented (DONE in RESEARCH.md)
  2. TUI rendering tests exist (widgets, layout, visual output)
  3. Key handling tests exist (navigation, input)
  4. TUI tests integrate with existing E2E infrastructure

Plans:
- [x] 07.1-01-PLAN.md — TUI snapshot tests (rendering + key handling) ✓

---

## Milestone Summary

**Decimal Phases:**
- Phase 7.1: TUI Testing (inserted after Phase 7 for TUI snapshot coverage)

**Key Decisions:**
- **ALL-RUST-E2E**: Phase 7 uses all-Rust approach (no Python). Fake Claude is a Rust test binary, workspace fixtures in Rust, share types with main crate.
- **TEST-MAIN-RS**: Use main.rs as integration test entry point (not mod.rs) for proper Rust test discovery in tests/e2e/.
- **FAKE-CLAUDE-LIB**: Named fake_claude_lib/ instead of fake_claude/ to avoid Rust module ambiguity with fake_claude.rs binary.
- **E2E-TEST-LOCATION**: Unit tests for fake_claude_lib placed in e2e test crate (not fake_claude binary) because harness=false prevents test discovery.
- **BINARY-HASH-DISCOVERY**: get_fake_claude_path() scans deps/ directory for fake_claude-HASH binaries to handle Cargo's hash-suffixed test binaries.
- **FLAT-CONFIG-TOML**: Config files use flat TOML format (no section header like [rslph]).
- **TESTBACKEND-SNAPSHOTS**: Use TestBackend with 80x24 fixed dimensions and insta assert_snapshot for TUI visual regression tests.

**Issues Resolved:**
- Fixed fake_claude binary to exit gracefully when FAKE_CLAUDE_CONFIG not set
- Fixed config TOML format in workspace fixtures (flat format, no section headers)

**Issues Deferred:**
- CLAUDE-INTERNET-FLAG: Remove --internet workaround flag from Claude CLI invocations
- CLAUDE-CLI-OUTPUT-FLAGS: Research Claude CLI --output-format stream-json and --json-schema flags

**Technical Debt Incurred:**
- None

---

*For current project status, see .planning/ROADMAP.md*
