---
phase: 06-tui-interface
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/tui/ui.rs
  - src/tui/widgets/mod.rs
  - src/tui/widgets/status_bar.rs
  - src/tui/widgets/progress_bar.rs
  - src/tui/mod.rs
autonomous: true

must_haves:
  truths:
    - "Status bar displays 'rslph' on left, 'project-name (model-name)' on right"
    - "Second line shows 'Iter X/Y | Task X/Y | XX% [progress bar]'"
    - "Context bar color changes: green (<50%), yellow (50-80%), red (>80%)"
    - "Footer displays key binding hints"
  artifacts:
    - path: "src/tui/ui.rs"
      provides: "Main render function using Layout"
      exports: ["render"]
    - path: "src/tui/widgets/status_bar.rs"
      provides: "2-line header widget"
      exports: ["render_header"]
    - path: "src/tui/widgets/progress_bar.rs"
      provides: "Context usage gauge with traffic light colors"
      exports: ["render_context_bar", "context_bar_color"]
  key_links:
    - from: "src/tui/ui.rs"
      to: "src/tui/widgets/status_bar.rs"
      via: "render_header call"
      pattern: "render_header\\(frame"
    - from: "src/tui/widgets/status_bar.rs"
      to: "src/tui/app.rs"
      via: "App state fields"
      pattern: "app\\.current_iteration|app\\.project_name"
---

<objective>
Create the header status bar and progress widgets that display iteration count, task count, model name, project name, and context usage bar with traffic light coloring.

Purpose: Provide the user with at-a-glance status information about the build progress. The 2-line header is always visible and gives immediate feedback on iteration progress, task completion, and context window usage.

Output: Fully functional status bar rendering with proper layout, progress gauge, and traffic light colors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-tui-interface/06-RESEARCH.md
@.planning/phases/06-tui-interface/06-CONTEXT.md
@.planning/phases/06-tui-interface/06-01-SUMMARY.md (after plan 01 completes)
@src/tui/app.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create main UI layout and render function</name>
  <files>src/tui/ui.rs, src/tui/mod.rs</files>
  <action>
Create ui.rs with the main render function that divides the frame into three areas:

```rust
pub fn render(frame: &mut Frame, app: &App) {
    let [header, body, footer] = Layout::vertical([
        Constraint::Length(2),  // 2-line header
        Constraint::Fill(1),    // Main output area (placeholder for now)
        Constraint::Length(1),  // Footer with key hints
    ]).areas(frame.area());

    render_header(frame, header, app);
    render_body(frame, body, app);    // Placeholder - implemented in Plan 03
    render_footer(frame, footer, app);
}
```

Implement `render_footer` inline in ui.rs:
- Single line with key hints: "j/k:scroll  {/}:iteration  p:pause  Ctrl+C:quit"
- Style: dim/gray text, centered or left-aligned

Implement `render_body` as a placeholder:
- Just render a simple Paragraph with "Output area" text
- Will be replaced in Plan 03

Add `pub mod ui;` to tui/mod.rs and re-export `render`.
  </action>
  <verify>
`cargo check` passes.
Layout struct from ratatui is used correctly with Constraint::Length and Constraint::Fill.
  </verify>
  <done>
Main render function exists with 3-area layout (header, body, footer).
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement status bar header widget</name>
  <files>src/tui/widgets/mod.rs, src/tui/widgets/status_bar.rs, src/tui/mod.rs</files>
  <action>
Create widgets/ directory with mod.rs that exports:
- `pub mod status_bar;`
- `pub mod progress_bar;`

Create status_bar.rs with:

1. `render_header(frame: &mut Frame, area: Rect, app: &App)`:
   - Split area into 2 rows using Layout::vertical
   - Row 1: "rslph" on left (bold) | "project-name (model-name)" on right
   - Row 2: Call `render_status_line` for iteration/task/context display

2. `render_status_line(frame: &mut Frame, area: Rect, app: &App)`:
   - Format: "Iter X/Y | Task X/Y | " followed by context bar
   - Use Layout::horizontal to split between text and context bar
   - Text part: ~30 chars for "Iter X/Y | Task X/Y | XX%"
   - Remaining space: context progress bar

Row 1 layout example:
```rust
let [left, right] = Layout::horizontal([
    Constraint::Fill(1),
    Constraint::Fill(1),
]).areas(row1);

frame.render_widget(
    Paragraph::new("rslph").style(Style::default().bold()),
    left
);
frame.render_widget(
    Paragraph::new(format!("{} ({})", app.project_name, app.model_name))
        .alignment(Alignment::Right),
    right
);
```

Add `pub mod widgets;` to tui/mod.rs.
  </action>
  <verify>
`cargo check` passes.
Header renders correctly with both rows showing proper content.
  </verify>
  <done>
Status bar header renders 2-line layout with branding, project/model, and iteration stats.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement context progress bar with traffic light colors</name>
  <files>src/tui/widgets/progress_bar.rs</files>
  <action>
Create progress_bar.rs with:

1. `context_bar_color(ratio: f64) -> Color`:
   - ratio < 0.5: Color::Green
   - ratio >= 0.5 and < 0.8: Color::Yellow
   - ratio >= 0.8: Color::Red

2. `render_context_bar(frame: &mut Frame, area: Rect, ratio: f64)`:
   - Use ratatui's Gauge widget
   - Set gauge_style with fg color from context_bar_color
   - Set ratio (clamped to 0.0..1.0)
   - Label shows percentage: format!("{}%", (ratio * 100.0) as u16)

Example:
```rust
pub fn render_context_bar(frame: &mut Frame, area: Rect, ratio: f64) {
    let ratio = ratio.clamp(0.0, 1.0);
    let color = context_bar_color(ratio);
    let percent = (ratio * 100.0) as u16;

    let gauge = Gauge::default()
        .gauge_style(Style::default().fg(color))
        .ratio(ratio)
        .label(format!("{}%", percent));

    frame.render_widget(gauge, area);
}
```

Integration: Call render_context_bar from status_bar.rs render_status_line function, passing the context bar area and app.context_usage.

Add unit tests for context_bar_color:
- 0.0 -> Green
- 0.49 -> Green
- 0.5 -> Yellow
- 0.79 -> Yellow
- 0.8 -> Red
- 1.0 -> Red
  </action>
  <verify>
`cargo test` passes for color tests.
`cargo check` passes.
  </verify>
  <done>
Context progress bar renders with traffic light colors based on usage percentage.
  </done>
</task>

</tasks>

<verification>
1. `cargo build` compiles successfully
2. `cargo test` passes for context_bar_color tests
3. Header area shows:
   - Line 1: "rslph" left-aligned, "project (model)" right-aligned
   - Line 2: "Iter X/Y | Task X/Y | XX% [colored gauge]"
4. Footer shows key binding hints
5. Traffic light colors work: <50% green, 50-80% yellow, >80% red
</verification>

<success_criteria>
- ui.rs has render function with 3-area layout
- status_bar.rs renders 2-line header correctly
- progress_bar.rs has traffic light coloring for context gauge
- Footer displays keyboard shortcut hints
- All code compiles and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-tui-interface/06-02-SUMMARY.md`
</output>
