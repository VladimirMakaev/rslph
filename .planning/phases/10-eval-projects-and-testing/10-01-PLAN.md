---
phase: 10-eval-projects-and-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Cargo.toml
  - src/eval/mod.rs
  - src/eval/projects.rs
  - evals/calculator/prompt.txt
  - evals/calculator/tests.jsonl
autonomous: true

must_haves:
  truths:
    - "Calculator eval project is embedded in the binary"
    - "Agent can see prompt.txt but cannot see tests.jsonl"
    - "List of built-in projects can be enumerated"
  artifacts:
    - path: "src/eval/projects.rs"
      provides: "Built-in project registry"
      exports: ["get_project", "list_projects", "extract_project_files", "get_test_data"]
    - path: "evals/calculator/prompt.txt"
      provides: "Calculator prompt for agent"
      min_lines: 10
    - path: "evals/calculator/tests.jsonl"
      provides: "Hidden test cases"
      min_lines: 10
  key_links:
    - from: "src/eval/projects.rs"
      to: "evals/"
      via: "include_dir! macro"
      pattern: "include_dir!"
---

<objective>
Set up built-in eval project infrastructure with calculator project embedded

Purpose: Enable the eval command to use built-in projects embedded in the binary rather than requiring external project directories
Output: Calculator eval project with prompt and hidden tests, registry for accessing embedded projects
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-eval-projects-and-testing/10-RESEARCH.md

@src/eval/mod.rs
@src/eval/command.rs
@Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add include_dir dependency and create project registry</name>
  <files>
    - Cargo.toml
    - src/eval/mod.rs
    - src/eval/projects.rs
  </files>
  <action>
1. Add `include_dir = "0.7"` to Cargo.toml dependencies

2. Create src/eval/projects.rs with the following structure:
   - Use `include_dir!("$CARGO_MANIFEST_DIR/evals")` to embed evals directory
   - Implement `get_project(name: &str) -> Option<&'static Dir<'static>>` to get a project by name
   - Implement `list_projects() -> Vec<&'static str>` to list all available projects
   - Implement `extract_project_files(project: &Dir, dest: &Path) -> std::io::Result<()>` that:
     - Recursively extracts all files EXCEPT tests.jsonl
     - Creates parent directories as needed
   - Implement `get_test_data(project: &Dir) -> Option<&'static str>` to get tests.jsonl content
   - Implement `is_builtin(name: &str) -> bool` helper

3. Update src/eval/mod.rs to:
   - Add `mod projects;`
   - Add `pub use projects::{get_project, list_projects, is_builtin};`
  </action>
  <verify>
    cargo check 2>&1 | head -20
    # Note: Will have warning about embedded directory not existing yet until Task 2
  </verify>
  <done>
    - include_dir dependency added to Cargo.toml
    - projects.rs exists with all 5 functions
    - Module exported from eval/mod.rs
  </done>
</task>

<task type="auto">
  <name>Task 2: Create calculator eval project with prompt and hidden tests</name>
  <files>
    - evals/calculator/prompt.txt
    - evals/calculator/tests.jsonl
  </files>
  <action>
1. Create evals/calculator/prompt.txt with:
```
Build a simple command-line calculator.

The program should:
1. Read a mathematical expression from stdin
2. Evaluate the expression
3. Print the result to stdout

Support these operations:
- Addition (+)
- Subtraction (-)
- Multiplication (*)
- Division (/)

Examples:
Input: "2 + 2"
Output: "4"

Input: "10 * 5"
Output: "50"

The program should handle integer arithmetic. You may use any programming language.
```

2. Create evals/calculator/tests.jsonl with 10+ test cases:
```json
{"input": "2 + 2", "expected": "4"}
{"input": "10 - 5", "expected": "5"}
{"input": "3 * 4", "expected": "12"}
{"input": "20 / 4", "expected": "5"}
{"input": "100 + 200", "expected": "300"}
{"input": "50 - 25", "expected": "25"}
{"input": "7 * 8", "expected": "56"}
{"input": "81 / 9", "expected": "9"}
{"input": "1 + 1", "expected": "2"}
{"input": "0 * 100", "expected": "0"}
```

3. Verify the project compiles and the files are embedded:
   - Run cargo build
   - Add a simple unit test to projects.rs that verifies:
     - `list_projects()` returns `["calculator"]`
     - `get_project("calculator")` returns Some
     - `get_test_data(project)` returns Some with 10+ lines
  </action>
  <verify>
    cargo test projects -- --nocapture
  </verify>
  <done>
    - evals/calculator/prompt.txt exists with calculator prompt
    - evals/calculator/tests.jsonl exists with 10 test cases
    - Unit tests pass confirming embedding works
  </done>
</task>

</tasks>

<verification>
- `cargo build` succeeds without errors
- `cargo test projects` passes
- The calculator project is embedded and accessible via the registry
- Test data is separate from prompt (get_test_data returns test content, extract_project_files excludes it)
</verification>

<success_criteria>
- include_dir crate integrated
- Calculator prompt and hidden tests created
- Project registry functional with list/get/extract/test_data functions
- Embedding verified via unit tests
</success_criteria>

<output>
After completion, create `.planning/phases/10-eval-projects-and-testing/10-01-SUMMARY.md`
</output>
