---
phase: 11-prompt-engineering
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - prompts/gsd/PROMPT_plan.md
  - prompts/gsd/PROMPT_build.md
autonomous: true

must_haves:
  truths:
    - "GSD plan prompt uses XML structure for task breakdown"
    - "GSD build prompt includes deviation handling rules (PROMPT-01)"
    - "GSD build prompt includes substantive completion summary format (PROMPT-02)"
    - "GSD prompts use must-haves verification pattern (PROMPT-05)"
  artifacts:
    - path: "prompts/gsd/PROMPT_plan.md"
      provides: "GSD-style planning prompt"
      min_lines: 100
    - path: "prompts/gsd/PROMPT_build.md"
      provides: "GSD-style build prompt with deviation handling"
      min_lines: 150
  key_links:
    - from: "prompts/gsd/PROMPT_plan.md"
      to: "prompts/gsd/PROMPT_build.md"
      via: "shared progress file structure"
      pattern: "## Must-Haves"
---

<objective>
Create GSD mode prompts with XML structure, deviation handling, and must-haves verification.

Purpose: Implement PROMPT-01 (deviation handling), PROMPT-02 (completion summaries), and PROMPT-05 (GSD patterns) in a coherent prompt pair.
Output: prompts/gsd/PROMPT_plan.md and prompts/gsd/PROMPT_build.md
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/11-prompt-engineering/CONTEXT.md
@.planning/phases/11-prompt-engineering/11-RESEARCH.md

# Current prompts for reference
@prompts/PROMPT_plan.md
@prompts/PROMPT_build.md

# GSD patterns (for adaptation)
# Key patterns: XML task structure, must-haves, STATE.md format
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GSD planning prompt</name>
  <files>prompts/gsd/PROMPT_plan.md</files>
  <action>
Create `prompts/gsd/` directory and `PROMPT_plan.md` with GSD-adapted planning prompt.

Key elements to include:

1. **XML task structure** - Use `<task>`, `<objective>`, `<verify>`, `<done>` tags
2. **Must-haves section** - Goal-backward verification criteria
3. **Progress file structure** - YAML frontmatter with phase tracking
4. **No testing-at-end anti-pattern** - Testing interleaved with implementation

Structure:
```markdown
# Planning Agent

You are a planning agent that transforms ideas into structured, executable task lists.

## Your Role

Given a user's idea, you will:
1. Analyze requirements
2. Derive must-have success criteria (goal-backward)
3. Break down into discrete tasks with XML structure
4. Organize into logical phases with testing interleaved
5. Output a structured progress file

## Output Format

<important>
- Output ONLY the raw progress file markdown
- Do NOT wrap in code fences
- Start directly with "# Progress:"
</important>

## Progress File Structure

[Include YAML frontmatter example with phase, status, iterations fields]

## Task XML Structure

Each task in the Tasks section should follow this format:

<task>
  <name>Brief task name</name>
  <action>What to do - specific, actionable instructions</action>
  <verify>Command or check to verify completion</verify>
  <done>Observable criteria for completion</done>
</task>

## Must-Haves Section

Derive must-haves using goal-backward methodology:

### Must-Haves

**Truths** (observable behaviors):
- [ ] User can do X
- [ ] System responds with Y

**Artifacts** (files that must exist):
- [ ] path/to/file.ext exists with real implementation

**Key Links** (critical connections):
- [ ] A connects to B via fetch/import/call

## Example Output

[Full example with YAML frontmatter, phases, XML tasks, must-haves]
```

Adapt the current PROMPT_plan.md philosophy but restructure with GSD patterns.
Keep the testing-interleaved philosophy from current prompts.
  </action>
  <verify>File exists at prompts/gsd/PROMPT_plan.md with >100 lines</verify>
  <done>GSD plan prompt includes XML task structure, must-haves section, YAML frontmatter format</done>
</task>

<task type="auto">
  <name>Task 2: Create GSD build prompt with deviation handling</name>
  <files>prompts/gsd/PROMPT_build.md</files>
  <action>
Create `prompts/gsd/PROMPT_build.md` with GSD-adapted build prompt.

Key elements (PROMPT-01, PROMPT-02, PROMPT-05):

1. **Deviation Handling Rules** (PROMPT-01):
```markdown
## Deviation Handling

When encountering blockers during task execution:

<deviation type="bug">
If you discover a bug while working on a task:
1. Document the bug in Recent Attempts
2. Fix the bug if it blocks current task (takes <5 min)
3. If complex bug: note it, complete current task, add bug fix as new task
</deviation>

<deviation type="missing-dependency">
If a required dependency/file is missing:
1. Check if it should have been created in earlier task
2. If earlier task incomplete: go back and complete it first
3. If design gap: note in Recent Attempts, make reasonable assumption
</deviation>

<deviation type="blocking-issue">
If completely blocked and cannot proceed:
1. Document thoroughly in Recent Attempts section
2. Mark task with [BLOCKED] prefix instead of [x]
3. Move to next task if independent
4. If all remaining tasks depend on blocked task: report and stop
</deviation>
```

2. **Substantive Completion Summary** (PROMPT-02):
```markdown
## Completion Summary Format

After completing each task, update "Completed This Iteration" with substantive details:

### Completed This Iteration

**Task:** [Task name from XML]

**What Changed:**
- Created/modified: [files with brief description]
- Key implementation: [1-2 sentences on approach]

**Verification:**
- Ran: [command]
- Result: [pass/fail with details]

**Next:** [What the next task needs to know]
```

3. **Must-Haves Verification** (PROMPT-05):
```markdown
## Must-Haves Check

Before marking RALPH_DONE, verify all must-haves:

**Truths Check:**
- [ ] Each observable behavior works as described

**Artifacts Check:**
- [ ] Each file exists and has real implementation (not stubs)

**Key Links Check:**
- [ ] Each connection is wired and functional
```

Also include:
- ONE TASK PER ITERATION rule
- RALPH_DONE placement rules
- Failure memory (Recent Attempts)
  </action>
  <verify>File exists at prompts/gsd/PROMPT_build.md with deviation handling, completion summary, and must-haves sections</verify>
  <done>GSD build prompt includes all three key patterns (PROMPT-01, PROMPT-02, PROMPT-05)</done>
</task>

</tasks>

<verification>
- prompts/gsd/PROMPT_plan.md exists with XML task structure
- prompts/gsd/PROMPT_build.md exists with:
  - Deviation handling section with bug/missing-dep/blocking rules
  - Substantive completion summary format
  - Must-haves verification before RALPH_DONE
- Both prompts use consistent progress file structure
</verification>

<success_criteria>
- [ ] prompts/gsd/PROMPT_plan.md created with XML task structure
- [ ] prompts/gsd/PROMPT_build.md includes deviation handling (PROMPT-01)
- [ ] Build prompt includes substantive summary format (PROMPT-02)
- [ ] Both prompts use must-haves pattern (PROMPT-05)
- [ ] Prompts are coherent pair with shared progress file format
</success_criteria>

<output>
After completion, create `.planning/phases/11-prompt-engineering/11-02-SUMMARY.md`
</output>
