---
phase: 12-multi-trial-results
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli.rs
  - src/eval/mod.rs
  - src/eval/statistics.rs
autonomous: true

must_haves:
  truths:
    - "CLI accepts --trials N flag with default value of 1"
    - "Statistics module computes mean, variance, min, max from a list of values"
    - "StatSummary struct provides std_dev() method"
  artifacts:
    - path: "src/cli.rs"
      provides: "Eval command with --trials flag"
      contains: "trials: u32"
    - path: "src/eval/statistics.rs"
      provides: "Statistical computation functions"
      exports: ["StatSummary", "TrialStatistics"]
    - path: "src/eval/mod.rs"
      provides: "Module re-exports"
      contains: "mod statistics"
  key_links:
    - from: "src/cli.rs"
      to: "Commands::Eval"
      via: "#[arg(long, default_value = \"1\")]"
      pattern: "trials.*default_value.*1"
    - from: "src/eval/statistics.rs"
      to: "f64 math"
      via: "mean/variance formulas"
      pattern: "sum.*count|powi\\(2\\)"
---

<objective>
Add --trials CLI flag and create statistics module for multi-trial aggregation

Purpose: Enable users to specify trial count and provide statistical computation for aggregating results across trials
Output: CLI flag parsing, StatSummary and TrialStatistics structs, statistical computation functions
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-multi-trial-results/12-RESEARCH.md

# Current implementation
@src/cli.rs
@src/eval/mod.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add --trials flag to Eval command in CLI</name>
  <files>src/cli.rs</files>
  <action>
Add --trials flag to the Eval command variant in Commands enum:

1. Add a new field to the Eval variant:
   - `trials: u32` with `#[arg(long, default_value = "1")]`
   - Add doc comment: `/// Number of independent trials to run`

2. Update the existing CLI test `test_parse_eval_command` to include the new field

3. Add a new test `test_parse_eval_with_trials` that verifies:
   - `rslph eval calculator --trials 5` parses correctly
   - trials field equals 5
  </action>
  <verify>`cargo test --lib test_parse_eval` passes (all eval CLI tests)</verify>
  <done>--trials flag parses with default 1, explicit value parsed correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create statistics module with StatSummary and TrialStatistics</name>
  <files>src/eval/statistics.rs, src/eval/mod.rs</files>
  <action>
Create new file `src/eval/statistics.rs` with:

1. `StatSummary` struct with fields:
   - `mean: f64`
   - `variance: f64`
   - `min: f64`
   - `max: f64`
   - `count: usize`

2. Implement `StatSummary`:
   - `from_values(values: &[f64]) -> Self` - compute all stats from a slice
   - Handle empty slice case: return zeros
   - Handle single-value case: variance = 0.0
   - Use Bessel's correction for sample variance: divide by (n-1) not n
   - `std_dev(&self) -> f64` - return variance.sqrt()

3. `TrialStatistics` struct with fields (all StatSummary):
   - `pass_rate: StatSummary`
   - `elapsed_secs: StatSummary`
   - `total_input_tokens: StatSummary`
   - `total_output_tokens: StatSummary`
   - `iterations: StatSummary`

4. Add unit tests in the same file:
   - `test_stat_summary_empty` - empty slice returns zeros
   - `test_stat_summary_single` - single value: mean = value, variance = 0
   - `test_stat_summary_multiple` - verify mean, variance, min, max for [1.0, 2.0, 3.0, 4.0, 5.0]
   - `test_stat_summary_std_dev` - verify std_dev equals sqrt(variance)

5. Update `src/eval/mod.rs`:
   - Add `mod statistics;`
   - Add `pub use statistics::{StatSummary, TrialStatistics};`

Derive Debug, Clone, Serialize on the structs for later JSON serialization.
  </action>
  <verify>`cargo test --lib statistics` passes, `cargo check` has no errors</verify>
  <done>StatSummary::from_values correctly computes mean, variance, min, max with edge cases handled</done>
</task>

</tasks>

<verification>
- [ ] `cargo test --lib test_parse_eval` - all eval CLI tests pass
- [ ] `cargo test --lib statistics` - all statistics tests pass
- [ ] `cargo check` - no compile errors
- [ ] `cargo clippy` - no warnings in new code
</verification>

<success_criteria>
1. `rslph eval calculator --trials 5` parses without error (--trials 5)
2. `rslph eval calculator` parses with trials = 1 (default)
3. StatSummary::from_values([1.0, 2.0, 3.0]) returns mean = 2.0
4. Statistics module exports available from `rslph::eval::{StatSummary, TrialStatistics}`
</success_criteria>

<output>
After completion, create `.planning/phases/12-multi-trial-results/12-01-SUMMARY.md`
</output>
