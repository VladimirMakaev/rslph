---
phase: 13.1-clippy-crates-io
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/fake_claude_lib/mod.rs
  - tests/fake_claude_lib/prebuilt.rs
  - tests/e2e/test_edge_cases.rs
  - src/tui/app.rs
  - Cargo.toml
autonomous: false

must_haves:
  truths:
    - "cargo clippy --all-targets -- -D warnings passes with zero errors"
    - "cargo package --list shows no .planning/* files"
    - "User can trigger crates.io publish via git tag"
  artifacts:
    - path: "tests/fake_claude_lib/mod.rs"
      provides: "Clean exports without unused public items"
    - path: "tests/fake_claude_lib/prebuilt.rs"
      provides: "Test helpers with allow(dead_code) for intentionally unused scenarios"
    - path: "src/tui/app.rs"
      provides: "Test code using ..Default::default() pattern"
    - path: "Cargo.toml"
      provides: "Package exclude rules for .planning"
  key_links:
    - from: "Cargo.toml"
      to: "cargo package"
      via: "exclude field"
      pattern: 'exclude\s*=\s*\['
---

<objective>
Fix all remaining clippy warnings and configure package exclusions for crates.io release.

Purpose: Enable CI to pass with `cargo clippy -- -D warnings` and ensure the published crate excludes internal planning documents.

Output: Clean clippy output, properly configured Cargo.toml with exclusions, ready for first crates.io release via git tag.
</objective>

<execution_context>
@/Users/vmakaev/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vmakaev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13.1-clippy-crates-io/13.1-RESEARCH.md

# Key source files with clippy warnings
@tests/fake_claude_lib/mod.rs
@tests/fake_claude_lib/prebuilt.rs
@tests/e2e/test_edge_cases.rs
@src/tui/app.rs
@Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix all clippy warnings</name>
  <files>
    tests/fake_claude_lib/mod.rs
    tests/fake_claude_lib/prebuilt.rs
    tests/e2e/test_edge_cases.rs
    src/tui/app.rs
  </files>
  <action>
Fix 30 clippy errors across 4 files:

**tests/fake_claude_lib/mod.rs:**
- Remove unused `pub use` exports: `FakeClaudeConfig`, `InvocationConfig`, `TokenConfig`, `FakeClaudeHandle`, `ScenarioBuilder`, `StreamEventOutput`
- Keep only the exports that are actually used by test code
- Check what's actually imported in test files before removing

**tests/fake_claude_lib/prebuilt.rs:**
- Remove `use super::*;` on line 298 (inside test module)
- Add `#[allow(dead_code)]` attribute to intentionally unused test helpers:
  - `CALCULATOR_PROGRESS` constant
  - `CALCULATOR_PROGRESS_DONE` constant
  - `PYTHON_CALCULATOR` constant
  - `calculator()` function
  - `fizzbuzz()` function
  - `timeout_retry()` function
  - `timeout_exhausted()` function
- These are prebuilt scenarios kept for future use - use module-level `#[allow(dead_code)]` at top

**tests/e2e/test_edge_cases.rs:**
- Remove unused import `std::os::unix::process::ExitStatusExt` on line 116

**src/tui/app.rs (test code only):**
Fix 8 occurrences of `field_reassign_with_default` in test functions. Replace pattern:
```rust
// OLD
let mut app = App::default();
app.field = value;

// NEW
let app = App {
    field: value,
    ..Default::default()
};
```

Specific locations (approximate line numbers from clippy output):
- Line 1191: scroll_offset = 0
- Line 1205: scroll_offset = 0
- Line 1215: current_iteration = 1
- Line 1235: current_iteration = 1
- Line 1250: current_iteration = 1, max_system_expanded = 3
- Line 1271: viewing_iteration = 1
- Line 1299: viewing_iteration = 1
- Line 1344: conversation_scroll = 20
  </action>
  <verify>
Run `cargo clippy --all-targets -- -D warnings` and confirm zero errors.
Run `cargo test` to ensure tests still pass after refactoring.
  </verify>
  <done>
cargo clippy --all-targets -- -D warnings exits with code 0 and no error output.
All tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure package exclusions for crates.io</name>
  <files>
    Cargo.toml
  </files>
  <action>
Add exclude field to [package] section in Cargo.toml to prevent internal files from being published:

```toml
[package]
# ... existing fields ...
exclude = [
    ".planning/*",
    ".github/*",
    "scripts/*",
]
```

The `.planning/` directory contains internal planning documents (100+ files).
The `.github/` directory contains CI workflows not needed by crate users.
The `scripts/` directory contains development scripts.

Verify package size is reasonable (should be under 500KB for a CLI tool).
  </action>
  <verify>
Run `cargo package --list --allow-dirty` and confirm:
- No `.planning/*` files in output
- No `.github/*` files in output
- No `scripts/*` files in output
- Source files, prompts, evals, and essential metadata remain

Run `cargo package --allow-dirty` to create the package and check size.
  </verify>
  <done>
cargo package --list shows only essential files (src/*, prompts/*, evals/*, Cargo.toml, README.md, etc.).
Package size is under 500KB.
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Trigger crates.io release via git tag</action>
  <what-needs-to-happen>
Before creating the release tag:

1. **Verify CARGO_REGISTRY_TOKEN secret is configured:**
   - Go to GitHub repo Settings -> Secrets and variables -> Actions
   - Confirm CARGO_REGISTRY_TOKEN exists (get from https://crates.io/settings/tokens)

2. **Verify version in Cargo.toml:**
   - Current version is 0.1.0
   - Update if needed before tagging

3. **Create and push version tag:**
   ```bash
   git tag v0.1.0
   git push origin v0.1.0
   ```

4. **Monitor release workflow:**
   - Go to GitHub Actions -> Release workflow
   - Confirm it runs and publishes successfully

5. **Verify installation:**
   ```bash
   cargo install rslph
   rslph --version
   ```
  </what-needs-to-happen>
  <resume-signal>Type "published" after crate is live on crates.io, or describe any issues encountered</resume-signal>
</task>

</tasks>

<verification>
1. `cargo clippy --all-targets -- -D warnings` passes with zero errors
2. `cargo test` passes (all existing tests work)
3. `cargo package --list` excludes .planning/*, .github/*, scripts/*
4. `cargo package` creates a package under 500KB
5. Package is published to crates.io (after user action)
6. `cargo install rslph` works from crates.io (after user action)
</verification>

<success_criteria>
- CI can run `cargo clippy --all-targets -- -D warnings` without failures
- Published crate does not include internal planning documents
- Package is published to crates.io and installable via `cargo install rslph`
</success_criteria>

<output>
After completion, create `.planning/phases/13.1-clippy-crates-io/13.1-01-SUMMARY.md`
</output>
