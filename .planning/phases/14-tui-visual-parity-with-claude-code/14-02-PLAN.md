---
phase: 14-tui-visual-parity
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - src/tui/widgets/mod.rs
  - src/tui/widgets/spinner.rs
  - src/tui/app.rs
  - src/tui/run.rs
autonomous: true

must_haves:
  truths:
    - "Spinner widget infrastructure exists and renders braille animation"
    - "Spinner uses Claude brand color (Crail)"
    - "Spinner animation advances on each frame tick"
    - "App has is_streaming flag and start/stop methods (wiring to events in Plan 06)"
  artifacts:
    - path: "src/tui/widgets/spinner.rs"
      provides: "Throbber wrapper widget for streaming indicator"
      min_lines: 30
    - path: "src/tui/app.rs"
      provides: "SpinnerState and is_streaming fields in App"
      contains: "spinner_state"
  key_links:
    - from: "src/tui/widgets/spinner.rs"
      to: "throbber_widgets_tui"
      via: "ThrobberState and Throbber imports"
      pattern: "use throbber_widgets_tui"
    - from: "src/tui/run.rs"
      to: "app.spinner_state"
      via: "calc_next() call in tick handler"
      pattern: "calc_next"
---

<objective>
Add animated braille spinner widget for LLM streaming indication.

Purpose: Provide visual feedback during LLM response streaming using an animated braille pattern spinner. This uses the throbber-widgets-tui crate added in 14-01.

Output: New spinner widget, App state updates, and tick handler integration. Note: Actual streaming event wiring (start_streaming/stop_streaming calls) happens in Plan 06.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-tui-visual-parity-with-claude-code/14-RESEARCH.md
@.planning/phases/14-tui-visual-parity-with-claude-code/14-01-SUMMARY.md
@src/tui/theme.rs
@src/tui/app.rs
@src/tui/run.rs
@src/tui/widgets/mod.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create spinner widget wrapper</name>
  <files>src/tui/widgets/spinner.rs, src/tui/widgets/mod.rs</files>
  <action>
Create `src/tui/widgets/spinner.rs`:

1. Import throbber_widgets_tui::{Throbber, ThrobberState, BRAILLE_SIX}
2. Import theme colors from crate::tui::theme::colors::CRAIL
3. Re-export ThrobberState for use in app.rs

4. Create render function:
```rust
pub fn render_spinner(
    frame: &mut Frame,
    area: Rect,
    state: &mut ThrobberState,
    label: &str,
) {
    let spinner = Throbber::default()
        .throbber_set(BRAILLE_SIX)
        .label(label)
        .style(Style::default().fg(CRAIL));

    frame.render_stateful_widget(spinner, area, state);
}
```

5. Add module to widgets/mod.rs: `pub mod spinner;`

Use BRAILLE_SIX for the animation pattern (6-dot braille cycling).
  </action>
  <verify>
`cargo check` succeeds.
`grep -n "render_spinner" src/tui/widgets/spinner.rs` shows function definition.
  </verify>
  <done>spinner.rs created with render_spinner function using throbber-widgets-tui</done>
</task>

<task type="auto">
  <name>Task 2: Add spinner state to App</name>
  <files>src/tui/app.rs</files>
  <action>
Modify App struct in src/tui/app.rs:

1. Add import at top:
   `use throbber_widgets_tui::ThrobberState;`

2. Add new fields to App struct (in appropriate section, perhaps after token tracking):
   ```rust
   // Spinner state for streaming indicator
   /// Spinner animation state.
   pub spinner_state: ThrobberState,
   /// Whether LLM is actively streaming.
   pub is_streaming: bool,
   ```

3. Initialize in Default impl:
   ```rust
   spinner_state: ThrobberState::default(),
   is_streaming: false,
   ```

4. Add helper methods:
   ```rust
   /// Start streaming indicator.
   pub fn start_streaming(&mut self) {
       self.is_streaming = true;
   }

   /// Stop streaming indicator.
   pub fn stop_streaming(&mut self) {
       self.is_streaming = false;
   }

   /// Advance spinner animation (call on tick).
   pub fn tick_spinner(&mut self) {
       if self.is_streaming {
           self.spinner_state.calc_next();
       }
   }
   ```
  </action>
  <verify>
`cargo check` succeeds.
`grep -n "spinner_state" src/tui/app.rs` shows field and usage.
  </verify>
  <done>App has spinner_state, is_streaming fields with helper methods</done>
</task>

<task type="auto">
  <name>Task 3: Integrate spinner tick in event loop</name>
  <files>src/tui/run.rs</files>
  <action>
Modify src/tui/run.rs to advance spinner on tick:

1. Find the tick handling section (where frame timing/events are processed)
2. Call `app.tick_spinner()` on each tick/frame

Look for the event loop structure - there should be a place where terminal is redrawn (typically after handling events). Add the spinner tick call there, before rendering:

```rust
// In the main event loop, before render:
app.tick_spinner();
```

The tick rate should already be set (typically ~100ms for smooth animation). If using crossterm event polling with timeout, the existing timing should work.
  </action>
  <verify>
`cargo check` succeeds.
`grep -n "tick_spinner" src/tui/run.rs` shows the call in event loop.
  </verify>
  <done>Spinner animation advances on each tick in the event loop</done>
</task>

</tasks>

<verification>
```bash
# Check compilation
cargo check

# Verify spinner widget exists
grep -n "render_spinner" src/tui/widgets/spinner.rs
grep -n "BRAILLE_SIX" src/tui/widgets/spinner.rs

# Verify App state additions
grep -n "spinner_state" src/tui/app.rs
grep -n "is_streaming" src/tui/app.rs
grep -n "tick_spinner" src/tui/app.rs

# Verify event loop integration
grep -n "tick_spinner" src/tui/run.rs

# Verify module export
grep -n "pub mod spinner" src/tui/widgets/mod.rs
```
</verification>

<success_criteria>
1. src/tui/widgets/spinner.rs exists with render_spinner function
2. Spinner uses BRAILLE_SIX pattern from throbber-widgets-tui
3. Spinner styled with CRAIL (Claude orange) color
4. App struct has spinner_state: ThrobberState field
5. App struct has is_streaming: bool field
6. App has start_streaming, stop_streaming, tick_spinner methods
7. Event loop calls tick_spinner on each frame
8. `cargo build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/14-tui-visual-parity-with-claude-code/14-02-SUMMARY.md`
</output>
