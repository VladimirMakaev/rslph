---
phase: 14-tui-visual-parity
plan: 05
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - src/tui/widgets/thread_view.rs
autonomous: true

must_haves:
  truths:
    - "Message groups use themed colors from theme.rs"
    - "Assistant messages use Claude brand color (Crail)"
    - "Tool messages use yellow from theme"
    - "System messages use Cloudy color from theme"
    - "Message groups display with box-drawn borders (satisfies TUI-06 at group level)"
  artifacts:
    - path: "src/tui/widgets/thread_view.rs"
      provides: "Role styling using theme module with box-drawn group borders"
      contains: "use crate::tui::theme"
  key_links:
    - from: "src/tui/widgets/thread_view.rs"
      to: "src/tui/theme.rs"
      via: "theme colors and styles import"
      pattern: "theme::colors|theme::styles"
---

<objective>
Update thread_view.rs to use centralized theme colors for message styling and add box-drawn borders to message groups.

Purpose: Replace hardcoded colors with theme module constants to ensure consistent Claude brand styling across the TUI. Assistant messages use Crail (Claude orange), and message groups are visually distinguished with box-drawn borders. This satisfies TUI-06 (box-drawn message borders with type-specific styling) at the message group level, which matches Claude Code's visual pattern where iterations/groups are bordered rather than individual messages.

Output: thread_view.rs using theme colors for all role styling with box-drawn group containers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-tui-visual-parity-with-claude-code/14-RESEARCH.md
@.planning/phases/14-tui-visual-parity-with-claude-code/14-01-SUMMARY.md
@src/tui/widgets/thread_view.rs
@src/tui/theme.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace hardcoded colors with theme colors</name>
  <files>src/tui/widgets/thread_view.rs</files>
  <action>
Update src/tui/widgets/thread_view.rs to use theme module:

1. Add import at top:
   ```rust
   use crate::tui::theme::{colors, styles};
   ```

2. Replace the role_style function with theme-based styling:
   ```rust
   /// Role colors using centralized theme.
   fn role_style(role: &MessageRole) -> Style {
       match role {
           MessageRole::User => styles::user(),
           MessageRole::Assistant => styles::assistant(),
           MessageRole::System => styles::system(),
           MessageRole::Tool(_) => styles::tool_header(),
       }
   }
   ```

3. Update any other hardcoded Color:: references to use theme colors:
   - `Color::Green` for Claude groups -> `colors::ASSISTANT` (Crail)
   - `Color::DarkGray` for system/collapsed -> `colors::THINKING`
   - `Color::Yellow` for highlights -> `colors::TOOL_CALL`
   - `Color::Cyan` for user -> `colors::USER`
   - `Color::Magenta` for tool results -> `colors::TOOL_RESULT`

4. Update format_group and format_system_group header styles:
   - Group header (Claude): Use `colors::ASSISTANT` (Crail) instead of Green
   - System group header: Use `colors::SYSTEM` (Cloudy) instead of DarkGray

5. Ensure all style construction uses theme constants:
   - Remove any inline `Color::Rgb()` or `Color::Green` etc.
   - All should reference theme::colors or use theme::styles functions
  </action>
  <verify>
`cargo check` succeeds.
`grep -n "use crate::tui::theme" src/tui/widgets/thread_view.rs` shows import.
`grep -c "Color::Green|Color::Cyan|Color::Yellow" src/tui/widgets/thread_view.rs` returns 0 (no hardcoded colors remain).
  </verify>
  <done>thread_view.rs uses theme colors exclusively, no hardcoded Color:: values</done>
</task>

<task type="auto">
  <name>Task 2: Add box borders to message groups</name>
  <files>src/tui/widgets/thread_view.rs</files>
  <action>
Enhance format_group to use box-drawn structure with type-specific styling:

1. Add import if needed:
   ```rust
   use ratatui::widgets::{Block, Borders, BorderType};
   ```

2. Update format_group to show box-like structure with role-specific border colors:
   - Assistant groups: Crail (orange) border
   - Tool groups: Yellow border
   - System groups: Cloudy (gray) border

   Since we're returning Vec<Line>, simulate box with Unicode:
   ```rust
   // Header with top border - color based on group type
   let border_color = match group.role_type {
       RoleType::Assistant => colors::ASSISTANT,
       RoleType::Tool => colors::TOOL_CALL,
       RoleType::System => colors::SYSTEM,
       _ => colors::CLOUDY,
   };
   let border_style = Style::default().fg(border_color);

   let header_line = format!("┌─ {} ─{}", group.header, "─".repeat(20));
   lines.push(Line::from(Span::styled(header_line, border_style)));

   // Content lines with left border
   for msg in visible {
       let content = format!("│ {}", format_tool_line(msg, false, false));
       lines.push(Line::from(Span::styled(content, role_style(&msg.role))));
   }

   // Bottom border or +N more indicator
   if hidden > 0 {
       lines.push(Line::from(Span::styled(
           format!("│ +{} more (Tab to expand)", hidden),
           Style::default().fg(colors::THINKING).add_modifier(Modifier::ITALIC),
       )));
   }
   lines.push(Line::from(Span::styled("└────────────────────────────", border_style)));
   ```

3. Similarly update format_system_group with subtle borders using CLOUDY color.

Note: The width of borders should adapt or be reasonable. Can use a fixed width or dynamic based on terminal width (if available).

This satisfies TUI-06 (box-drawn message borders with type-specific styling) by applying distinct border colors to each message group type (assistant=Crail, tool=Yellow, system=Cloudy).
  </action>
  <verify>
`cargo check` succeeds.
Visual inspection shows box characters in format_group output.
  </verify>
  <done>Message groups display with box-drawn borders using Unicode characters and type-specific colors</done>
</task>

</tasks>

<verification>
```bash
# Check compilation
cargo check

# Verify theme import
grep -n "use crate::tui::theme" src/tui/widgets/thread_view.rs

# Verify no hardcoded colors remain
grep -c "Color::Green|Color::Yellow|Color::Magenta" src/tui/widgets/thread_view.rs || echo "OK: no hardcoded colors"

# Verify theme usage
grep -n "colors::|styles::" src/tui/widgets/thread_view.rs

# Verify box characters added
grep -n "┌|│|└" src/tui/widgets/thread_view.rs
```
</verification>

<success_criteria>
1. thread_view.rs imports theme::{colors, styles}
2. role_style function uses styles::user(), styles::assistant(), etc.
3. No hardcoded Color::Green, Color::Yellow, Color::Magenta remain
4. Group headers use colors::ASSISTANT (Crail) for Claude styling
5. System groups use colors::SYSTEM (Cloudy) for styling
6. Message groups display with Unicode box-drawing characters
7. Box border colors are type-specific (assistant=Crail, tool=Yellow, system=Cloudy)
8. `cargo build` succeeds with no warnings
</success_criteria>

<output>
After completion, create `.planning/phases/14-tui-visual-parity-with-claude-code/14-05-SUMMARY.md`
</output>
