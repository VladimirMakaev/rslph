---
phase: 15-interactive-planning
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - src/planning/command.rs
autonomous: true

must_haves:
  truths:
    - "CLI mode planning detects when Claude asks questions"
    - "Questions are displayed to the user in a formatted way"
    - "User can enter multi-line answers via stdin"
    - "Answers are collected and formatted for session resume"
  artifacts:
    - path: "src/planning/command.rs"
      provides: "Interactive question detection and answer collection for CLI mode"
      contains: "collect_answers"
  key_links:
    - from: "run_adaptive_planning"
      to: "StreamResponse.has_questions"
      via: "question detection after initial run"
      pattern: "has_questions"
---

<objective>
Implement interactive input collection for CLI mode (non-TUI) planning.

Purpose: Allow users to answer Claude's clarifying questions during planning when not using TUI mode.

Output: Updated adaptive planning flow that detects questions and prompts for user input.
</objective>

<execution_context>
@/Users/vmakaev/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vmakaev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-interactive-planning/15-RESEARCH.md
@.planning/phases/15-interactive-planning/15-01-SUMMARY.md
@src/planning/command.rs
@src/subprocess/stream_json.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add question display and answer collection helper functions</name>
  <files>src/planning/command.rs</files>
  <action>
    1. Add function display_questions(questions: &[String]):
       - Print a header: "Claude is asking clarifying questions:"
       - Print each question numbered (1. Question one?, 2. Question two?, etc.)
       - Print a footer with instructions for answering

    2. Add function format_answers_for_resume(questions: &[String], answers: &str) -> String:
       - Create a formatted message for Claude that pairs questions with answers
       - Format:
         ```
         Here are my answers to your questions:

         Q1: [question 1]
         A1: [relevant part of answer]

         Q2: [question 2]
         A2: [relevant part of answer]
         ...
         ```
       - Note: User provides free-form answers, Claude will interpret which answer goes with which question

    3. The existing read_multiline_input() function already handles collecting multi-line answers (double-enter to submit)
  </action>
  <verify>cargo build -p rslph</verify>
  <done>Helper functions for displaying questions and formatting answers exist</done>
</task>

<task type="auto">
  <name>Task 2: Update basic planning to capture session_id and detect questions</name>
  <files>src/planning/command.rs</files>
  <action>
    1. Modify run_basic_planning() to track the StreamResponse with session_id and questions

    2. After Claude finishes, check if stream_response.has_questions():
       - If true, call display_questions() with the flattened question list
       - Call read_multiline_input() to get user answers
       - Format answers using format_answers_for_resume()
       - Store session_id and formatted answers for next task

    3. For now, just detect and display - session resume will be implemented in Plan 03

    4. Return early if questions detected with informative message asking user to run with --adaptive for full flow
       (Basic mode doesn't support interactive; this is a stopgap)
  </action>
  <verify>cargo build -p rslph</verify>
  <done>Basic planning detects questions and informs user to use adaptive mode</done>
</task>

<task type="auto">
  <name>Task 3: Update adaptive planning to collect answers when questions detected</name>
  <files>src/planning/command.rs</files>
  <action>
    1. In run_adaptive_planning(), after the final planning call:
       - Check if stream_response.has_questions()
       - If true:
         a. Display the questions using display_questions()
         b. Collect answers using read_multiline_input()
         c. Store session_id and formatted answers for resume (next plan)

    2. For now, after collecting answers:
       - Print "Answers collected. Session resume will be implemented in the next phase."
       - Continue with normal flow (parse what Claude returned)

    3. This prepares the foundation for Plan 03 which adds the actual resume capability
  </action>
  <verify>cargo build -p rslph</verify>
  <done>Adaptive planning collects user answers when Claude asks questions</done>
</task>

</tasks>

<verification>
1. Run cargo build to verify compilation
2. Run cargo test to ensure existing tests pass
3. Run cargo clippy to check for warnings
</verification>

<success_criteria>
- Helper functions for question display and answer formatting are implemented
- Basic planning detects questions and provides informative message
- Adaptive planning collects user answers when questions are detected
- All existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/15-interactive-planning/15-02-SUMMARY.md`
</output>
