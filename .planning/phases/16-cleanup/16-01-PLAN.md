---
phase: 16-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/prompts/modes.rs
  - src/prompts/defaults.rs
  - src/prompts/loader.rs
  - src/cli.rs
  - src/config.rs
  - src/planning/command.rs
  - src/build/state.rs
  - src/eval/parallel.rs
  - src/eval/command.rs
  - prompts/gsd_tdd/PROMPT_plan.md
  - prompts/gsd_tdd/PROMPT_build.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "Codebase search for 'gsd_tdd' returns zero matches in source files"
    - "Codebase search for 'GsdTdd' returns zero matches in source files"
    - "User running rslph --mode gsd_tdd receives error about unknown mode"
    - "cargo build succeeds without warnings about gsd_tdd"
    - "cargo test passes without gsd_tdd-related tests"
  artifacts:
    - path: "src/prompts/modes.rs"
      provides: "PromptMode enum with only Basic and Gsd variants"
      not_contains: "GsdTdd"
    - path: "src/prompts/defaults.rs"
      provides: "Default prompt loading for Basic and Gsd only"
      not_contains: "GSD_TDD"
    - path: "prompts/gsd_tdd/"
      provides: "DELETED - directory should not exist"
  key_links:
    - from: "src/prompts/defaults.rs"
      to: "src/prompts/modes.rs"
      via: "match arms reference PromptMode variants"
      pattern: "PromptMode::(Basic|Gsd)"
---

<objective>
Remove the gsd_tdd prompt mode entirely from the codebase.

Purpose: The gsd_tdd mode is deprecated in v1.3. Removing it simplifies the codebase and reduces maintenance burden. GSD personas (Phase 19) will replace this with a more flexible approach.

Output: Codebase with only Basic and Gsd prompt modes. All gsd_tdd enum variants, match arms, tests, prompts, and documentation removed.
</objective>

<execution_context>
@/Users/vmakaev/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vmakaev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-cleanup/16-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove gsd_tdd enum variant and match arms</name>
  <files>
    - src/prompts/defaults.rs
    - src/prompts/modes.rs
  </files>
  <action>
    **CRITICAL: Follow this exact order to avoid compilation errors.**

    1. In `src/prompts/defaults.rs`:
       - Remove lines 14-15: `pub const GSD_TDD_PLAN: &str = include_str!(...);` and `pub const GSD_TDD_BUILD: &str = include_str!(...);`
       - Remove line 26: `PromptMode::GsdTdd => GSD_TDD_PLAN` match arm in `plan_prompt()`
       - Remove line 35: `PromptMode::GsdTdd => GSD_TDD_BUILD` match arm in `build_prompt()`
       - Remove lines 74-81: `test_gsd_tdd_prompts_exist` test function

    2. In `src/prompts/modes.rs`:
       - Remove line 35: `GsdTdd` enum variant from `PromptMode` enum
       - Remove lines 59-62: test case for `gsd_tdd` parsing in `test_prompt_mode_from_str`
       - Remove line 69: `GsdTdd.to_string()` assertion in `test_prompt_mode_to_string`
       - Remove lines 74-78: serde roundtrip test using GsdTdd

    3. Run `cargo check` to verify compilation succeeds before proceeding.
  </action>
  <verify>
    - `cargo check` passes with no errors
    - `grep -r "GsdTdd" src/prompts/` returns no matches
    - `grep -r "GSD_TDD" src/prompts/` returns no matches
  </verify>
  <done>
    PromptMode enum has exactly 2 variants: Basic and Gsd. No compilation errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove gsd_tdd references from CLI, config, and commands</name>
  <files>
    - src/cli.rs
    - src/config.rs
    - src/planning/command.rs
    - src/build/state.rs
    - src/eval/parallel.rs
    - src/eval/command.rs
    - src/prompts/loader.rs
  </files>
  <action>
    1. In `src/cli.rs`:
       - Line 25: Remove `gsd_tdd` from help text for `--mode` option (change "basic, gsd, gsd_tdd" to "basic, gsd")
       - Line 81: Update comment about modes (remove gsd_tdd mention)
       - Lines 396, 414: Remove test cases that use `gsd_tdd` mode
       - Lines 472, 475, 484: Remove test vectors with `gsd_tdd`

    2. In `src/config.rs`:
       - Line 109: Update comment to remove gsd_tdd mention

    3. In `src/planning/command.rs`:
       - Line 33: Update doc comment to remove GsdTdd mention

    4. In `src/build/state.rs`:
       - Line 97: Update comment to remove GsdTdd mention

    5. In `src/eval/parallel.rs`:
       - Line 269: Remove test using `PromptMode::GsdTdd`

    6. In `src/eval/command.rs`:
       - Line 532: Update comment to remove gsd_tdd mention

    7. In `src/prompts/loader.rs`:
       - Lines 113-114, 127: Remove tests using `PromptMode::GsdTdd`

    8. Run `cargo test` to verify all tests pass.
  </action>
  <verify>
    - `cargo test` passes
    - `grep -rn "gsd_tdd\|GsdTdd" src/` returns no matches
  </verify>
  <done>
    All source files are free of gsd_tdd/GsdTdd references. All tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 3: Delete gsd_tdd prompts and update documentation</name>
  <files>
    - prompts/gsd_tdd/PROMPT_plan.md
    - prompts/gsd_tdd/PROMPT_build.md
    - README.md
  </files>
  <action>
    1. Delete the entire `prompts/gsd_tdd/` directory:
       ```bash
       rm -rf prompts/gsd_tdd/
       ```

    2. In `README.md`, remove all gsd_tdd documentation:
       - Line 96: Remove `gsd_tdd` from `--mode` description (change "basic, gsd, gsd_tdd" to "basic, gsd")
       - Line 114: Remove `--mode gsd_tdd` example
       - Line 132: Remove `gsd_tdd` from modes list
       - Lines 173, 195, 239, 266: Remove gsd_tdd references in various sections
       - Lines 299-313: Delete entire gsd_tdd section under "Modes and Prompts"
       - Line 389: Remove from eval example

    3. Final verification that no gsd_tdd references remain in the entire codebase.
  </action>
  <verify>
    - `ls prompts/gsd_tdd/` returns "No such file or directory"
    - `grep -rn "gsd_tdd" .` (excluding .planning/) returns no matches
    - `cargo build --release` succeeds
    - `cargo test` passes
  </verify>
  <done>
    gsd_tdd prompt directory deleted. README updated. No gsd_tdd references remain in codebase.
  </done>
</task>

</tasks>

<verification>
Run the following commands to verify complete removal:

1. **No source references:**
   ```bash
   grep -rn "gsd_tdd\|GsdTdd\|GSD_TDD" src/ prompts/ README.md
   # Should return no matches
   ```

2. **Build succeeds:**
   ```bash
   cargo build --release
   ```

3. **All tests pass:**
   ```bash
   cargo test
   ```

4. **CLI rejects gsd_tdd mode:**
   ```bash
   cargo run -- build --mode gsd_tdd progress.md 2>&1 | grep -i "invalid\|error\|unknown"
   # Should show error about invalid mode
   ```
</verification>

<success_criteria>
1. `grep -rn "gsd_tdd" src/ prompts/` returns zero matches
2. `grep -rn "GsdTdd" src/` returns zero matches
3. `prompts/gsd_tdd/` directory does not exist
4. `cargo build --release` succeeds
5. `cargo test` passes with all tests
6. `rslph --mode gsd_tdd` produces an error about invalid mode
</success_criteria>

<output>
After completion, create `.planning/phases/16-cleanup/16-01-SUMMARY.md`
</output>
