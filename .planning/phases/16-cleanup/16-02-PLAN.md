---
phase: 16-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli.rs
  - src/main.rs
  - src/build/command.rs
  - src/planning/command.rs
  - src/eval/command.rs
  - src/eval/parallel.rs
autonomous: true

must_haves:
  truths:
    - "CLI has no --no-tui flag for plan, build, or eval commands"
    - "All commands always launch TUI (unless dry_run mode)"
    - "cargo build succeeds without no_tui parameters"
  artifacts:
    - path: "src/cli.rs"
      provides: "CLI definitions without no_tui fields"
      not_contains: "no_tui"
    - path: "src/main.rs"
      provides: "Command dispatch without no_tui conditionals"
      not_contains: "no_tui"
    - path: "src/build/command.rs"
      provides: "Build command handler without no_tui parameter"
      not_contains: "no_tui: bool"
  key_links:
    - from: "src/main.rs"
      to: "src/build/command.rs"
      via: "calls run_build_command without no_tui"
      pattern: "run_build_command\\("
    - from: "src/main.rs"
      to: "src/planning/command.rs"
      via: "calls run_plan_command without tui param"
      pattern: "run_plan_command\\("
---

<objective>
Remove --no-tui CLI flags and no_tui parameters from all command handlers.

Purpose: TUI-only mode simplifies the codebase by removing conditional branching between TUI and headless execution. The only exception is dry_run mode which remains text-only by design.

Output: CLI with no --no-tui flags. Command handlers that always use TUI (except dry_run). All no_tui parameters removed from function signatures.
</objective>

<execution_context>
@/Users/vmakaev/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vmakaev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-cleanup/16-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove --no-tui from CLI definitions</name>
  <files>
    - src/cli.rs
  </files>
  <action>
    Remove the `no_tui` field from Plan, Build, and Eval command structs:

    1. **Plan command** (lines 48-50):
       - Remove the entire `no_tui: bool` field and its `#[arg(...)]` attribute
       - Field was: `#[arg(long, help = "Disable TUI mode")] pub no_tui: bool`

    2. **Build command** (lines 66-68):
       - Remove the entire `no_tui: bool` field and its `#[arg(...)]` attribute

    3. **Eval command** (lines 89-91):
       - Remove the entire `no_tui: bool` field and its `#[arg(...)]` attribute

    4. Update any tests in cli.rs that reference `no_tui`:
       - Search for tests that set `no_tui: true` and remove that field

    Run `cargo check` to identify any compilation errors from missing `no_tui` fields.
  </action>
  <verify>
    - `cargo check` shows errors in main.rs and command handlers (expected - we removed fields they reference)
    - `grep -n "no_tui" src/cli.rs` returns no matches
  </verify>
  <done>
    CLI structs have no no_tui fields. Compiler errors expected in downstream code (fixed in Task 2).
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove no_tui from main.rs and command handlers</name>
  <files>
    - src/main.rs
    - src/build/command.rs
    - src/planning/command.rs
    - src/eval/command.rs
    - src/eval/parallel.rs
  </files>
  <action>
    **In src/main.rs:**

    1. **Plan command dispatch** (around lines 43, 76-78, 83):
       - Remove `no_tui` from the Plan struct destructure
       - Remove conditional print statement that used no_tui
       - Call `run_plan_command(...)` without the `tui` parameter (it will always be true)

    2. **Build command dispatch** (around lines 110, 116-127, 135):
       - Remove `no_tui` from the Build struct destructure
       - Remove the `let use_tui = config.tui_enabled && !no_tui && !dry_run;` calculation
       - Simplify to: always pass `tui: true` to run_build_command (or remove param)
       - Keep dry_run as a separate concern (dry_run mode is text-only by design)

    3. **Eval command dispatch** (around lines 161, 196-198):
       - Remove `no_tui` from the Eval struct destructure
       - Remove conditional print statement that used no_tui

    **In src/build/command.rs:**

    1. **run_build_command function** (around line 49, 60-69, 91-101):
       - Remove `no_tui: bool` from function signature
       - Remove all conditional logic that branches on no_tui
       - Keep logic that handles dry_run separately (dry_run is text-only)

    2. **Unit tests** (lines around 626, 657, 711, 787, 837, 885, 1000, 1102, 1175, 1240, 1341):
       - Remove `no_tui: true` from test function calls
       - Tests will need to either:
         a) Call the function without no_tui parameter, OR
         b) Be restructured to test with TUI (handled in Plan 16-03)

    **In src/planning/command.rs:**

    1. **run_plan_command function** (around lines 47, 56-68):
       - Remove `tui: bool` from function signature
       - Always use TUI mode internally

    **In src/eval/command.rs:**

    1. **run_eval_command function** (around lines 56, 69, 91, 147-173):
       - Remove `no_tui: bool` from function signature
       - Remove conditional logic branching on no_tui

    2. **run_parallel_eval_mode function** (around lines 140-173):
       - Remove `no_tui: bool` parameter and conditional

    3. **run_single_trial function** (around lines 377, 469):
       - Remove `_no_tui` parameter

    **In src/eval/parallel.rs:**

    1. **run_parallel_evals function** (around lines 71, 85, 121):
       - Remove `no_tui: bool` parameter

    2. **run_trial function** (around lines 154, 187):
       - Remove `no_tui: bool` parameter

    Run `cargo check` after each file to catch errors early.
  </action>
  <verify>
    - `cargo check` passes with no errors
    - `grep -rn "no_tui" src/` returns no matches (except possibly in comments, which should also be removed)
    - `grep -rn "use_tui.*no_tui" src/` returns no matches
  </verify>
  <done>
    All no_tui parameters removed from function signatures. Conditional TUI logic removed. cargo check passes.
  </done>
</task>

<task type="auto">
  <name>Task 3: Fix unit tests that passed no_tui</name>
  <files>
    - src/build/command.rs
    - src/eval/command.rs
    - src/eval/parallel.rs
  </files>
  <action>
    After removing no_tui parameters, unit tests that called functions with `no_tui: true` will fail to compile.

    For each affected test:

    1. **If the test can work with TUI disabled via config:**
       - Remove the `no_tui: true` argument
       - Ensure the test uses a config with `tui_enabled: false` to skip TUI

    2. **If the test requires headless mode for output capture:**
       - Mark the test as `#[ignore]` with comment: `// TODO: Restructure in Plan 16-03`
       - These will be fixed when E2E tests are restructured to use library directly

    3. **If the test is a simple unit test that doesn't need TUI:**
       - Just remove the no_tui parameter; test should pass

    Common pattern - tests often construct a config with:
    ```rust
    let config = BuildConfig {
        tui_enabled: false,  // This field should remain, controlling TUI behavior
        // ...
    };
    ```

    The `tui_enabled` config field is NOT being removed - it's the CLI flag and function parameters that are being removed. Config can still control TUI behavior.

    Run `cargo test` to verify all tests compile and run.
  </action>
  <verify>
    - `cargo test` compiles successfully
    - `cargo test` passes (some tests may be `#[ignore]`d pending Plan 16-03)
    - `grep -rn "no_tui" src/` returns no matches
  </verify>
  <done>
    All unit tests updated to remove no_tui arguments. Tests either pass or are marked #[ignore] for restructuring in Plan 16-03.
  </done>
</task>

</tasks>

<verification>
Run the following commands to verify complete removal:

1. **No no_tui in source:**
   ```bash
   grep -rn "no_tui" src/
   # Should return no matches
   ```

2. **Build succeeds:**
   ```bash
   cargo build --release
   ```

3. **Tests pass:**
   ```bash
   cargo test
   ```

4. **CLI has no --no-tui flag:**
   ```bash
   cargo run -- plan --help 2>&1 | grep -i "no-tui"
   cargo run -- build --help 2>&1 | grep -i "no-tui"
   cargo run -- eval --help 2>&1 | grep -i "no-tui"
   # All three should return no matches
   ```
</verification>

<success_criteria>
1. `grep -rn "no_tui" src/` returns zero matches
2. `cargo run -- plan --help` shows no --no-tui flag
3. `cargo run -- build --help` shows no --no-tui flag
4. `cargo run -- eval --help` shows no --no-tui flag
5. `cargo build --release` succeeds
6. `cargo test` passes (unit tests; E2E tests fixed in Plan 16-03)
</success_criteria>

<output>
After completion, create `.planning/phases/16-cleanup/16-02-SUMMARY.md`
</output>
